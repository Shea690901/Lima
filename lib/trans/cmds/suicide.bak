/* Do not remove the headers from this file! see /USAGE for more info. */

// Rust wrote this and was a bad boy and didn't attach a header - Beek
// Code Snarfed from passwd and turned into suicide by --OH.

#include <mudlib.h>

inherit CMD;
inherit M_INPUT;

private nomask void done()
{
    modal_pop();
    destruct();
    return;
}

private nomask void confirm_current_password(string s)
{
    string id = this_user()->query_id();
    write("\n");

    if ( !this_user()->matches_password(s) )
    {
	write("Invalid password.\nAborting.\n");
	done();
    }
    else
    {
	write( "Consider this not farewell, but merely au revoir.\n");
	modal_pop();
	this_user()->quit();
	LAST_LOGIN_D->remove_user( id, 0 );
	destruct();
	return;
    }
}

void start_cmd()
{
    if(!clonep() || (base_name(previous_object()) != base_name()))  {
	write("Illegal attempt to spoof command\n"); 
	destruct();
	return;
    }

    modal_push((: confirm_current_password :),
      "Enter your current password to confirm suicide: ", 1);
}


private void main()
{
    if(!clonep())  {
	new(base_name())->start_cmd();
	return;
    }
    destruct();
    return;
}

